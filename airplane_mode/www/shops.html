<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>Airport Shops</title>
		<link rel="stylesheet" href="/assets/airplane_mode/css/shops.css" />
	</head>
	<body>
		{% set shop = frappe.form_dict.get("shop") %} {% if not shop %}
		<!-- LIST VIEW -->
		<div class="header">
			<h1>Airport Shops</h1>
			<div>
				<span class="badge">Total: {{ frappe.db.count("Airport Shop") }}</span>
				<span class="badge"
					>Available: {{ frappe.db.count("Airport Shop", {"status":"Available"}) }}</span
				>
				<span class="badge"
					>Occupied: {{ frappe.db.count("Airport Shop", {"status":"Occupied"}) }}</span
				>
			</div>
		</div>

		<div class="grid">
			{% for s in frappe.get_all("Airport Shop",
			fields=["name","airport","status","image","shop_number"]) %}
			<div class="card">
				<h3>{{ s.shop_number or s.name }}</h3>
				<div>Airport: {{ s.airport }}</div>
				<div>Status: {{ s.status }}</div>
				{% if s.image %}
				<div style="margin: 6px 0"><img src="{{ s.image }}" width="100%" /></div>
				{% endif %}
				<!-- Link to the SAME page with a query param -->
				<div style="margin-top: 8px">
					<a class="btn" href="/shops?shop={{ s.name | urlencode }}">View</a>
				</div>
			</div>
			{% endfor %}
		</div>

		{% else %}
		<!-- DETAIL VIEW -->
		{% if not frappe.db.exists("Airport Shop", shop) %}
		<h1 style="margin: 24px">Shop not found: {{ shop }}</h1>
		<p style="margin: 24px"><a class="btn" href="/shops">← Back to list</a></p>
		{% else %} {% set doc = frappe.get_doc("Airport Shop", shop) %}
		<a class="btn" href="/shops">← Back to list</a>
		<h1>{{ doc.shop_number or doc.name }}</h1>
		<p><b>Airport:</b> {{ doc.airport }}</p>
		<p><b>Area:</b> {{ doc.area }} sqft</p>
		<p><b>Status:</b> {{ doc.status }}</p>
		{% if doc.image %}
		<p><img src="{{ doc.image }}" width="400" /></p>
		{% endif %}
		<hr />
		<h3>Interested in this shop?</h3>
		<a class="btn" href="/shop-lead?shop={{ doc.name | urlencode }}">Send Enquiry</a>
		{% endif %} {% endif %}
	</body>
</html>
